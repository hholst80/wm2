# AGENTS.md

## Pywayland Protocol Bindings â€” Circular Import Pattern

The files under `protocols/river_window_management_v1/` are autogenerated by the pywayland scanner, then hand-patched to fix circular imports.

`river_seat_v1.py` imports `RiverWindowV1` and `river_window_v1.py` needs `RiverSeatV1`. Python cannot resolve this at module load time because both modules are partially initialized when they try to import each other.

The fix lives in `river_window_v1.py`:

1. **No top-level import of `RiverSeatV1`.** Instead, a lazy loader defers the import until first use:
   ```python
   _RiverSeatV1 = None
   def _get_RiverSeatV1():
       global _RiverSeatV1
       if _RiverSeatV1 is None:
           from .river_seat_v1 import RiverSeatV1
           _RiverSeatV1 = RiverSeatV1
       return _RiverSeatV1
   ```

2. **Event decorator `interface` args use `None`** instead of the class reference, since the class isn't available at decoration time:
   ```python
   Argument(ArgumentType.Object, interface=None),  # RiverSeatV1 set lazily
   ```

**Do not replace these with direct imports.** Doing so will crash `wm2.py` on startup with `ImportError: cannot import name 'RiverSeatV1' from partially initialized module` and the window manager will fail to start.

If you regenerate protocol bindings, you must reapply this patch.
